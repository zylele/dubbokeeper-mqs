<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dubboclub.dk.storage.mysql.mapper.DayTradingMapper">
    <insert id="addDayTrading" parameterType="DayTradingPo">
    	insert into statistics_day (tx_code,chnl_code,start_time,timestamp,total_time_num,now_time,success,fail)
    	values (#{txCode},#{chnlCode},#{startTime},#{timestamp},#{totalTimeNum},#{nowTime},#{success},#{fail})
    </insert>
    <update id="updateDayTradingByTxCode" parameterType="DayTradingPo">
    	update statistics_day set
   		total_time_num = #{totalTimeNum}
    	where timestamp = #{timestamp}
    </update>
    <select id="selectDayTradingByTxCode" resultType="DayTradingPo"  parameterType="DayTradingPo">
       select start_time as startTime,total_time_num as totalTimeNum,timestamp
       from statistics_day 
       where 1=1 timestamp = #{timestamp}  
    </select>
    <select id="selectDayTradingByPageByCondition" parameterType="DayTradingQuery" resultType="DayTradingPo">
    	select start_time as startTime,sum(total_time_num) as totalTimeNum,timestamp
    	from statistics_day 
    	where timestamp &gt; #{dayTradingStartDate} and timestamp &lt; #{dayTradingEndDate}
    	group by timestamp
    	order by timestamp ASC
    </select>
    <delete id="deleteDayTradingByPageByCondition" parameterType="DayTradingPo">
    	delete from statistics_day
    	where timestamp &lt; #{timestamp}
    </delete>
    
    <select id="selectDayTradingByMinute" parameterType="DayTradingQuery" resultType="DayTradingPo">
    	select start_time as startTime,total_time_num as totalTimeNum,success as success,fail as fail 
    	from statistics_day 
    	where now_time &gt;= #{dayTradingStartDate} and now_time &lt;= #{dayTradingEndDate}
    	<if test="txCode != null and txCode != ''">
    		and tx_code = #{txCode}
    	</if>
    	<if test="chnlCode != null and chnlCode != ''">
    		and chnl_code = #{chnlCode}
    	</if>
    	order by start_time
    </select>
    
    <select id="selectDayTradingByHour" parameterType="DayTradingQuery" resultType="DayTradingPo">
    	select substr(start_time,1,13) as startTime,sum(total_time_num) as totalTimeNum,sum(success) as success,sum(fail) as fail 
    	from statistics_day 
    	where now_time &gt;= #{dayTradingStartDate} and now_time &lt;= #{dayTradingEndDate}
    	<if test="txCode != null and txCode != ''">
    		and tx_code = #{txCode}
    	</if>
    	<if test="chnlCode != null and chnlCode != ''">
    		and chnl_code = #{chnlCode}
    	</if>
    	group by substr(start_time,1,13) order by start_time
    </select>
    
    <select id="selectDayTradingByDay" parameterType="DayTradingQuery" resultType="DayTradingPo">
    	select now_time as nowTime,sum(total_time_num) as totalTimeNum,sum(success) as success,sum(fail) as fail 
    	from statistics_day 
    	where now_time &gt;= #{dayTradingStartDate} and now_time &lt;= #{dayTradingEndDate}
    	<if test="txCode != null and txCode != ''">
    		and tx_code = #{txCode}
    	</if>
    	<if test="chnlCode != null and chnlCode != ''">
    		and chnl_code = #{chnlCode}
    	</if>
    	group by now_time order by start_time
    </select>

</mapper>